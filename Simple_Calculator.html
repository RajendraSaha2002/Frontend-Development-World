<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1a1a2e;
            font-family: 'Segoe UI', sans-serif;
        }

        .calculator {
            background: #16213e;
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            width: 340px;
        }

        /* Display */
        .display {
            background: #0f3460;
            border-radius: 16px;
            padding: 20px 16px 12px;
            margin-bottom: 20px;
            min-height: 110px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: flex-end;
            overflow: hidden;
        }

        .history {
            font-size: 13px;
            color: #a0aec0;
            min-height: 20px;
            word-break: break-all;
            text-align: right;
        }

        .expression {
            font-size: 18px;
            color: #81e6d9;
            min-height: 24px;
            word-break: break-all;
            text-align: right;
            margin: 4px 0;
        }

        .result {
            font-size: 38px;
            font-weight: 700;
            color: #ffffff;
            word-break: break-all;
            text-align: right;
            transition: font-size 0.2s;
        }

        .result.small { font-size: 26px; }

        /* Buttons Grid */
        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        button {
            border: none;
            border-radius: 14px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            height: 64px;
            transition: all 0.15s ease;
            outline: none;
        }

        button:active { transform: scale(0.93); }

        /* Button types */
        .btn-num {
            background: #1a365d;
            color: #e2e8f0;
        }
        .btn-num:hover { background: #2a4a7f; }

        .btn-op {
            background: #2d3748;
            color: #81e6d9;
        }
        .btn-op:hover { background: #4a5568; }

        .btn-equal {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        .btn-equal:hover { background: linear-gradient(135deg, #7c8ff5, #8a5cb8); }

        .btn-clear {
            background: #c53030;
            color: white;
        }
        .btn-clear:hover { background: #e53e3e; }

        .btn-action {
            background: #2d3748;
            color: #f6ad55;
        }
        .btn-action:hover { background: #4a5568; }

        .btn-zero { grid-column: span 2; }

        /* History Panel */
        .history-panel {
            margin-top: 16px;
            background: #0f3460;
            border-radius: 12px;
            padding: 10px 14px;
            max-height: 100px;
            overflow-y: auto;
        }

        .history-panel h4 {
            color: #a0aec0;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }

        .history-item {
            color: #e2e8f0;
            font-size: 13px;
            padding: 2px 0;
            border-bottom: 1px solid #1a365d;
            cursor: pointer;
            text-align: right;
        }

        .history-item:hover { color: #81e6d9; }
        .history-item:last-child { border-bottom: none; }

        .no-history { color: #4a5568; font-size: 12px; text-align: center; }

        /* Keyboard hint */
        .hint {
            text-align: center;
            color: #4a5568;
            font-size: 11px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="calculator">
    <div class="display">
        <div class="history" id="history"></div>
        <div class="expression" id="expression"></div>
        <div class="result" id="result">0</div>
    </div>

    <div class="buttons">
        <button class="btn-clear" onclick="clearAll()">AC</button>
        <button class="btn-action" onclick="toggleSign()">+/-</button>
        <button class="btn-action" onclick="percentage()">%</button>
        <button class="btn-op" onclick="inputOp('/')">÷</button>

        <button class="btn-num" onclick="inputNum('7')">7</button>
        <button class="btn-num" onclick="inputNum('8')">8</button>
        <button class="btn-num" onclick="inputNum('9')">9</button>
        <button class="btn-op" onclick="inputOp('*')">×</button>

        <button class="btn-num" onclick="inputNum('4')">4</button>
        <button class="btn-num" onclick="inputNum('5')">5</button>
        <button class="btn-num" onclick="inputNum('6')">6</button>
        <button class="btn-op" onclick="inputOp('-')">−</button>

        <button class="btn-num" onclick="inputNum('1')">1</button>
        <button class="btn-num" onclick="inputNum('2')">2</button>
        <button class="btn-num" onclick="inputNum('3')">3</button>
        <button class="btn-op" onclick="inputOp('+')">+</button>

        <button class="btn-num btn-zero" onclick="inputNum('0')">0</button>
        <button class="btn-num" onclick="inputDot()">.</button>
        <button class="btn-equal" onclick="calculate()">=</button>
    </div>

    <div class="history-panel">
        <h4>History</h4>
        <div id="historyList"><p class="no-history">No history yet</p></div>
    </div>

    <p class="hint">⌨️ Keyboard supported</p>
</div>

<script>
    let current = '0';
    let prev = '';
    let operator = '';
    let shouldReset = false;
    let historyLog = [];

    const resultEl = document.getElementById('result');
    const expressionEl = document.getElementById('expression');
    const historyEl = document.getElementById('history');
    const historyListEl = document.getElementById('historyList');

    function updateDisplay() {
        resultEl.textContent = current;
        resultEl.className = 'result' + (current.length > 9 ? ' small' : '');
        expressionEl.textContent = prev && operator ? prev + ' ' + opSymbol(operator) : '';
    }

    function opSymbol(op) {
        return { '+': '+', '-': '−', '*': '×', '/': '÷' }[op] || op;
    }

    function inputNum(n) {
        if (shouldReset) { current = n; shouldReset = false; }
        else current = current === '0' ? n : current + n;
        updateDisplay();
    }

    function inputDot() {
        if (shouldReset) { current = '0.'; shouldReset = false; }
        else if (!current.includes('.')) current += '.';
        updateDisplay();
    }

    function inputOp(op) {
        if (operator && !shouldReset) calculate(true);
        prev = current;
        operator = op;
        shouldReset = true;
        updateDisplay();
    }

    function calculate(chain = false) {
        if (!operator || !prev) return;
        let a = parseFloat(prev), b = parseFloat(current), res;
        const expr = prev + ' ' + opSymbol(operator) + ' ' + current;

        switch (operator) {
            case '+': res = a + b; break;
            case '-': res = a - b; break;
            case '*': res = a * b; break;
            case '/':
                if (b === 0) { current = 'Error'; operator = ''; prev = ''; updateDisplay(); return; }
                res = a / b; break;
        }

        res = parseFloat(res.toFixed(10)).toString();

        if (!chain) {
            historyLog.unshift(expr + ' = ' + res);
            if (historyLog.length > 10) historyLog.pop();
            updateHistoryPanel();
            historyEl.textContent = expr + ' =';
        }

        current = res;
        operator = chain ? operator : '';
        prev = '';
        shouldReset = true;
        updateDisplay();
    }

    function clearAll() {
        current = '0'; prev = ''; operator = ''; shouldReset = false;
        historyEl.textContent = '';
        updateDisplay();
    }

    function toggleSign() {
        current = (parseFloat(current) * -1).toString();
        updateDisplay();
    }

    function percentage() {
        current = (parseFloat(current) / 100).toString();
        updateDisplay();
    }

    function updateHistoryPanel() {
        if (historyLog.length === 0) {
            historyListEl.innerHTML = '<p class="no-history">No history yet</p>';
            return;
        }
        historyListEl.innerHTML = historyLog.map(h =>
            `<div class="history-item" onclick="loadHistory('${h.split(' = ')[1]}')">${h}</div>`
        ).join('');
    }

    function loadHistory(val) {
        current = val; shouldReset = false; updateDisplay();
    }

    // Keyboard support
    document.addEventListener('keydown', e => {
        if (e.key >= '0' && e.key <= '9') inputNum(e.key);
        else if (e.key === '.') inputDot();
        else if (e.key === '+') inputOp('+');
        else if (e.key === '-') inputOp('-');
        else if (e.key === '*') inputOp('*');
        else if (e.key === '/') { e.preventDefault(); inputOp('/'); }
        else if (e.key === 'Enter' || e.key === '=') calculate();
        else if (e.key === 'Backspace') {
            current = current.length > 1 ? current.slice(0, -1) : '0';
            updateDisplay();
        }
        else if (e.key === 'Escape') clearAll();
        else if (e.key === '%') percentage();
    });

    updateDisplay();
</script>
</body>
</html>